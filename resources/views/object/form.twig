{% extends "page.twig" %}

{% block pageTitle %}{{ schema.title }} element{% endblock %}

{% block breadcrumbs %}
  <div class="col-lg-10">
    <h2>{{ schema.title }} elements</h2>
    <ol class="breadcrumb">
        <li>
            <a href="/">Dashboard</a>
        </li>        
        <li>
            <a href="/schemas/">All schemas</a>
        </li>        
        <li>
            <a href="/{{ schema.id }}">{{ schema.title }}</a>
        </li>
        <li class="active">
            <strong>{{ object.id }}</strong>
        </li>
    </ol>
  </div>
{% endblock %}

{% block content %}

  <div class="ibox float-e-margins">
    <div class="ibox-title">
      {% if object.title %}
        <h5>{{ object.title }}</h5>
      {% else %}
        <h5>{{ object.id }}</h5>
      {% endif %}
    </div>

    <div class="ibox-content">
      <form enctype="multipart/form-data" class="form-horizontal" action="/{{ schema.id }}/{{ object.id }}" method="post">
        {{ csrf_field() }}

        {% for field in schema.fields %}
          <div class="form-group">
            {% if field.title %}
              <label class="col-sm-2 control-label">{{ field.title }}</label>
            {% else %}
              <label class="col-sm-2 control-label">{{ field.name }}</label>
            {% endif %}
              <div class="col-sm-10">
                {% if field.multiple %}
                  {% if 'ref ' in field.type %}                  
                    <select name="{{ field.name }}[]" id="{{ field.name }}" class="chosen-select" multiple>
                      <option value="">Not specified</option>
                      {% for element in object.relations[field.type] %}
                        {% if element in object.fields[field.name] %}
                          <option selected value="{{ element.id }}">{{ element.shortView() }}</option>
                        {% else %}
                          <option value="{{ element.id }}">{{ element.shortView() }}</option>
                        {% endif %}
                      {% endfor %}
                    </select>
                  {% elseif field.type == "String" %}
                    {% if object.fields[field.name] %}
                      {% for key, string in object.fields[field.name] %}
                        <input name="{{ field.name }}[{{ key }}]" id="{{ field.name }}" type="text" class="form-control form-control-multiple" value="{{ string }}">
                      {% endfor %}
                    {% endif %}
                    {% for i in object.fields[field.name]|length .. object.fields[field.name]|length + 1 %}
                      <input name="{{ field.name }}[{{ i }}]" id="{{ field.name }}" type="text" class="form-control form-control-multiple" value="">
                    {% endfor %}                     
                  {% elseif field.type == "Uuid" %}
                    {% if object.fields[field.name] %}
                      {% for key, string in object.fields[field.name] %}
                        <input name="{{ field.name }}[{{ key }}]" id="{{ field.name }}" type="text" class="form-control form-control-multiple" value="{{ string }}">
                      {% endfor %}
                    {% endif %}
                    {% for i in object.fields[field.name]|length .. object.fields[field.name]|length + 1 %}
                      <input name="{{ field.name }}[{{ i }}]" id="{{ field.name }}" type="text" class="form-control form-control-multiple" value="">
                    {% endfor %}                  
                  {% elseif field.type == "Text" %}
                    {% if object.fields[field.name] %}
                      {% for key, string in object.fields[field.name] %}
                        <textarea data-html-editor="1" name="{{ field.name }}[{{ key }}]" id="{{ field.name }}" type="text" class="form-control form-control-multiple">{{ string }}</textarea>
                      {% endfor %}
                    {% endif %}
                    {% for i in object.fields[field.name]|length .. object.fields[field.name]|length + 1 %}
                      <textarea data-html-editor="1" name="{{ field.name }}[{{ key }}]" id="{{ field.name }}" type="text" class="form-control form-control-multiple"></textarea>
                    {% endfor %}
                  {% elseif field.type == "Integer" %}
                    {% if object.fields[field.name] %}
                      {% for key, string in object.fields[field.name] %}
                        <input name="{{ field.name }}[{{ key }}]" id="{{ field.name }}" type="text" class="form-control form-control-multiple" value="{{ string }}">
                      {% endfor %}
                    {% endif %}
                    {% for i in object.fields[field.name]|length .. object.fields[field.name]|length + 1 %}
                      <input name="{{ field.name }}[{{ i }}]" id="{{ field.name }}" type="text" class="form-control form-control-multiple" value="">
                    {% endfor %}                  
                  {% elseif field.type == "Double" %}
                    {% if object.fields[field.name] %}
                      {% for key, string in object.fields[field.name] %}
                        <input name="{{ field.name }}[{{ key }}]" id="{{ field.name }}" type="text" class="form-control form-control-multiple" value="{{ string }}">
                      {% endfor %}
                    {% endif %}
                    {% for i in object.fields[field.name]|length .. object.fields[field.name]|length + 1 %}
                      <input name="{{ field.name }}[{{ i }}]" id="{{ field.name }}" type="text" class="form-control form-control-multiple" value="">
                    {% endfor %}
                  {% elseif field.type == "Money" %}
                    {% if object.fields[field.name] %}
                      {% for key, string in object.fields[field.name] %}
                        <input name="{{ field.name }}[{{ key }}]" id="{{ field.name }}" type="text" class="form-control form-control-multiple" value="{{ string }}">
                      {% endfor %}
                    {% endif %}
                    {% for i in object.fields[field.name]|length .. object.fields[field.name]|length + 1 %}
                      <input name="{{ field.name }}[{{ i }}]" id="{{ field.name }}" type="text" class="form-control form-control-multiple" value="">
                    {% endfor %}                  
                  {% elseif field.type == "DateTime" %}
                    {% if object.fields[field.name] %}
                      {% for key, string in object.fields[field.name] %}
                        <div class="input-group date form-control-multiple">
                          <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                          <input data-datepicker="1" name="{{ field.name }}[{{ key }}]" id="{{ field.name }}" type="text" class="form-control" value="{{ string }}">
                        </div>
                      {% endfor %}
                    {% endif %}
                    {% for i in object.fields[field.name]|length .. object.fields[field.name]|length + 1 %}
                      <div class="input-group date form-control-multiple">
                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        <input data-datepicker="1" name="{{ field.name }}[{{ i }}]" id="{{ field.name }}" type="text" class="form-control" value="">
                      </div>
                    {% endfor %}
                  {% elseif field.type == "Json" %}
                    {% if object.fields[field.name] %}
                      {% for key, json in object.fields[field.name] %}
                        <textarea name="{{ field.name }}[{{ key }}]" id="{{ field.name }}" class="form-control form-control-multiple">{{ json }}</textarea>
                      {% endfor %}
                    {% endif %}
                    {% for i in object.fields[field.name]|length .. object.fields[field.name]|length + 1 %}
                      <textarea name="{{ field.name }}[{{ i }}]" id="{{ field.name }}" class="form-control form-control-multiple"></textarea>
                    {% endfor %}
                  {% endif %}
                {% else %}
                  {% if field.type == "String" %}
                    <input name="{{ field.name }}" id="{{ field.name }}" type="text" class="form-control" value="{{ object.fields[field.name] }}">   
                  {% elseif field.type == "Boolean" %}
                    {% if (object.fields[field.name]) %}
                      <input checked name="{{ field.name }}" id="{{ field.name }}" type="checkbox">
                    {% else %}
                      <input name="{{ field.name }}" id="{{ field.name }}" type="checkbox">
                    {% endif %}
                  {% elseif field.type == "DateTime" %}
                    <div class="input-group date">
                      <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                      <input data-datepicker="1" name="{{ field.name }}" id="{{ field.name }}" type="text" class="form-control" value="{{ object.fields[field.name] }}">
                    </div>
                  {% elseif field.type == "Text" %}
                    <textarea data-html-editor="1" name="{{ field.name }}" id="{{ field.name }}" class="form-control">{{ object.fields[field.name] }}</textarea>
                  {% elseif field.type == "ref Users" %}
                    <select name="{{ field.name }}" id="{{ field.name }}" class="form-control">
                      <option value="">Not specified</option>
                      {% for user in object.relations['ref Users'] %}
                        {% if user.id == object.fields[field.name].id %}
                          <option selected value="{{ user.id }}">{{ user.username }}</option>
                        {% else %}
                          <option value="{{ user.id }}">{{ user.username }}</option>
                        {% endif %}
                      {% endfor %}
                    </select>
                  {% elseif 'ref ' in field.type %}
                    <select name="{{ field.name }}" id="{{ field.name }}" class="form-control">
                      <option value="">Not specified</option>
                      {% for element in object.relations[field.type] %}
                        {% if element.id == object.fields[field.name].id %}
                          <option selected value="{{ element.id }}">{{ element.shortView() }}</option>
                        {% else %}
                          <option value="{{ element.id }}">{{ element.shortView() }}</option>
                        {% endif %}
                      {% endfor %}
                    </select>
                  {% elseif field.type == "Json" %}
                    <textarea name="{{ field.name }}" id="{{ field.name }}" class="form-control">{{ object.fields[field.name]|json_encode() }}</textarea>
                  {% else %}
                    <input name="{{ field.name }}" id="{{ field.name }}" type="text" class="form-control" value="{{ object.fields[field.name] }}">
                  {% endif %}
                {% endif %}
              </div>
          </div>  
        {% endfor %}

        <hr/>

        <button type="submit" name="action" value="list" class="btn btn-primary">Save object</button>
        <button type="submit" name="action" value="form" class="btn btn-primary">Apply changes</button>
        <a href="/{{ schema.id }}/{{ object.id }}/delete" class="btn btn-default pull-right">Delete element</a>

      </form>
    </div>
  </div>

{% endblock %}